name: Monitor React Native New Issues

on:
  pull_request: #to remove before landing
  schedule:
    - cron: "0 0,6,12,18 * * *"
  workflow_dispatch:

jobs:
  monitor-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        uses:  ./.github/actions/yarn-install
      - name: Extract next oncall
        run: |
          ONCALLS=$(node ./.github/workflow-scripts/extractIssueOncalls.js "${{ secrets.ONCALL_SCHEDULE }}" )
          ONCALL1=$(echo $ONCALLS | cut -d ' ' -f 1)
          ONCALL2=$(echo $ONCALLS | cut -d ' ' -f 2)
          echo "oncall1=$ONCALL1" >> $GITHUB_ENV
          echo "oncall2=$ONCALL2" >> $GITHUB_ENV
      - name: Print oncalls
        run: |
          echo "oncall1: ${{ env.oncall1 }}"
          echo "oncall2: ${{ env.oncall2 }}"
      # Uncomment before landing
      # - name: Monitor New Issues
      #   uses: react-native-community/repo-monitor@v1.0.1
      #   with:
      #     task: "monitor-issues"
      #     git_secret: ${{ secrets.GITHUB_TOKEN }}
      #     notifier: "discord"
      #     fetch_data_interval: 6
      #     repo_owner: "facebook"
      #     repo_name: "react-native"
      #     discord_webhook_url: "${{ secrets.DISCORD_WEBHOOK_URL }}"
      #     discord_id_type: "role"
      #     discord_ids: "${{ env.oncall1 }},${{ env.oncall2 }}"
